<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sadhana Yoga Retreat - Booking</title>
    <style>
        :root {
            --dark-green: #506C4A;
            --light-green: #8DA399;
            --gold: #C9A96E;
            --text-color: #192812;
            --background: #F4F1EC;
            --light-accent: #E8E4D9;
            --white: #FFFFFF;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(80, 108, 74, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text-color);
            line-height: 1.6;
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1, h2, h3 {
            color: var(--dark-green);
            margin-bottom: 1rem;
        }

        h2 {
            border-bottom: 1px solid var(--light-accent);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .section {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        label {
            font-weight: 600;
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            color: var(--dark-green);
        }

        input, select, textarea {
            padding: 12px;
            width: 100%;
            margin-top: 4px;
            border: 1px solid var(--light-accent);
            border-radius: var(--border-radius);
            background-color: var(--white);
            font-size: 16px;
            transition: var(--transition);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--dark-green);
            box-shadow: 0 0 0 2px rgba(80, 108, 74, 0.2);
        }

        button {
            padding: 12px 24px;
            margin-top: 15px;
            cursor: pointer;
            background-color: var(--dark-green);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 16px;
            transition: var(--transition);
        }

        button:hover {
            background-color: #3e553c;
            transform: translateY(-2px);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--dark-green) 0%, #3e553c 100%);
            color: white;
            border-radius: var(--border-radius);
        }

        .header h1 {
            color: white;
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .retreat-card {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .retreat-info {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            background-color: rgba(80, 108, 74, 0.05);
            border-radius: var(--border-radius);
        }

        .booking-form {
            flex: 1;
            min-width: 300px;
        }

        .price-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--dark-green);
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            background-color: rgba(80, 108, 74, 0.1);
            border-radius: var(--border-radius);
        }

        .departure-note {
            font-style: italic;
            color: var(--dark-green);
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .phone-container {
            display: flex;
            gap: 10px;
        }

        .country-code {
            width: 120px;
        }

        .phone-number {
            flex: 1;
        }

        #adminBtn {
            background-color: transparent;
            color: var(--dark-green);
            border: 2px solid var(--dark-green);
        }

        #adminBtn:hover {
            background-color: rgba(80, 108, 74, 0.1);
        }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .retreat-card { flex-direction: column; }
            .header h1 { font-size: 1.8rem; }
            .phone-container { flex-direction: column; }
            .country-code { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Sadhana Yoga Retreat</h1>
        <p>Find peace, balance, and renewal in the heart of nature</p>
    </div>

    <div class="section">
        <h2>Book Your Yoga Retreat</h2>

        <div class="retreat-card">
            <div class="retreat-info">
                <h3>Important Information</h3>
                <p>Arrival is on 3 PM. This will be on Sadhana's booking calendar, so confirm first before filling the information.</p>
                <ul style="margin-top: 15px; padding-left: 20px;">
                    <li>Check-in: 3 PM on arrival day</li>
                    <li>Check-out: 11 AM after breakfast on departure day</li>
                    <li>All bookings are subject to availability</li>
                    <li>Please arrive 15 minutes early for orientation</li>
                </ul>
            </div>

            <div class="booking-form">
                <form id="bookingForm">
                    <label>Guest Name</label>
                    <input type="text" name="guest_name" required placeholder="Enter your full name">

                    <label>Country</label>
                    <input type="text" name="country" required placeholder="Your country of residence">

                    <label>Email</label>
                    <input type="email" name="email" required placeholder="Your email address">

                    <label>WhatsApp / Phone</label>
                    <div class="phone-container">
                        <select class="country-code" id="countryCode" required>
                            <option value="" disabled selected>Code</option>
                            <option value="93">+93 (Afghanistan)</option>
                            <option value="355">+355 (Albania)</option>
                            <option value="213">+213 (Algeria)</option>
                            <option value="376">+376 (Andorra)</option>
                        </select>
                        <input type="text" class="phone-number" id="phoneNumber" required placeholder="Phone number">
                    </div>
                    <input type="hidden" id="phone" name="phone">

                    <label>Retreat Package</label>
                    <select id="retreatPackage" name="package" required>
                        <option value="" disabled selected>Select Package</option>
                        <option value="Silent Yoga Retreat 6D/6N">Silent Yoga Retreat 6D/6N</option>
                        <option value="Yoga and Ayurvedic Massage 2D/2N">Yoga and Ayurvedic Massage 2D/2N</option>
                        <option value="Introductory Hatha Yoga 4D/4N">Introductory Hatha Yoga 4D/4N</option>
                        <option value="Yogic Cleansing and Stretching 2D/2N">Yogic Cleansing and Stretching 2D/2N</option>
                        <option value="One-Day Yoga and Meditation 1DAY">One-Day Yoga and Meditation 1DAY</option>
                        <option value="Fasting and Gastro-Cleansing 7D/7N">Fasting and Gastro-Cleansing 7D/7N</option>
                        <option value="Yoga and Juice Fasting 4D/4N">Yoga and Juice Fasting 4D/4N</option>
                        <option value="Silent Detox Retreat in Nepal 6D/6N">Silent Detox Retreat in Nepal 6D/6N</option>
                        <option value="Standard Hatha Yoga 7D/7N">Standard Hatha Yoga 7D/7N</option>
                    </select>

                    <label>Room Type</label>
                    <select id="roomType" name="room_type" required>
                        <option value="" disabled selected>Select Room Type</option>
                    </select>

                    <label>Price</label>
                    <div class="price-display" id="priceDisplay">$0</div>
                    <input type="hidden" id="price" name="price">

                    <label>Arrival Date</label>
                    <input type="date" name="arrival_date" required>

                    <label>Departure Date</label>
                    <input type="date" name="departure_date" readonly>
                    <div class="departure-note">Check-out at 11 AM after breakfast</div>

                    <label>Remarks</label>
                    <textarea name="remarks" rows="3" placeholder="Any special requests or dietary requirements"></textarea>

                    <button type="submit">Submit Booking</button>
                </form>
            </div>
        </div>

        <button id="adminBtn" onclick="window.location.href='admin-login.html'">ADMIN ACCESS</button>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // Configuration
        const scriptURL = "https://script.google.com/macros/s/AKfycbycehH5GfUKtJbB1wmGSCb8Wmx8Z6unUM_OaeKSUh67bH_6obgZgZEF3fkmuIjViy_G/exec";

        const pricing = {
            "Silent Yoga Retreat 6D/6N": { "Private": 479 },
            "Yoga and Ayurvedic Massage 2D/2N": { "Private": 179, "Double": 149, "Dormitory": 119 },
            "Introductory Hatha Yoga 4D/4N": { "Private": 319, "Double": 259, "Dormitory": 199 },
            "Yogic Cleansing and Stretching 2D/2N": { "Private": 159, "Double": 129, "Dormitory": 99 },
            "One-Day Yoga and Meditation 1DAY": { "Dormitory": 79 },
            "Fasting and Gastro-Cleansing 7D/7N": { "Private": 559, "Double": 455, "Dormitory": 349 },
            "Yoga and Juice Fasting 4D/4N": { "Private": 319, "Double": 259, "Dormitory": 199 },
            "Silent Detox Retreat in Nepal 6D/6N": { "Private": 479, "Double": 389 },
            "Standard Hatha Yoga 7D/7N": { "Private": 559, "Double": 455, "Dormitory": 349 }
        };

        const retreatDuration = {
            "Silent Yoga Retreat 6D/6N": 6,
            "Yoga and Ayurvedic Massage 2D/2N": 2,
            "Introductory Hatha Yoga 4D/4N": 4,
            "Yogic Cleansing and Stretching 2D/2N": 2,
            "One-Day Yoga and Meditation 1DAY": 1,
            "Fasting and Gastro-Cleansing 7D/7N": 7,
            "Yoga and Juice Fasting 4D/4N": 4,
            "Silent Detox Retreat in Nepal 6D/6N": 6,
            "Standard Hatha Yoga 7D/7N": 7
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const retreatSelect = document.getElementById("retreatPackage");
            const roomSelect = document.getElementById("roomType");
            const priceDisplay = document.getElementById("priceDisplay");
            const arrivalInput = document.querySelector('input[name="arrival_date"]');
            const departureInput = document.querySelector('input[name="departure_date"]');
            const countryCodeSelect = document.getElementById("countryCode");
            const phoneNumberInput = document.getElementById("phoneNumber");
            const phoneHiddenInput = document.getElementById("phone");

            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            arrivalInput.min = today;

            // Event listeners
            retreatSelect.addEventListener("change", function() {
                updateRoomTypes();
                updateDepartureDate();
            });

            roomSelect.addEventListener("change", updatePrice);
            arrivalInput.addEventListener("change", updateDepartureDate);
            
            countryCodeSelect.addEventListener("change", updatePhoneField);
            phoneNumberInput.addEventListener("input", updatePhoneField);

            // Form submission
            document.getElementById("bookingForm").addEventListener("submit", handleBookingSubmit);

            function updatePhoneField() {
                const countryCode = countryCodeSelect.value;
                const phoneNumber = phoneNumberInput.value.replace(/\D/g, '');
                if (countryCode && phoneNumber) {
                    phoneHiddenInput.value = `https://wa.me/${countryCode}${phoneNumber}`;
                }
            }

            function updateRoomTypes() {
                const retreat = retreatSelect.value;
                roomSelect.innerHTML = "<option value='' disabled selected>Select Room Type</option>";
                if (pricing[retreat]) {
                    Object.keys(pricing[retreat]).forEach(rt => {
                        const opt = document.createElement("option");
                        opt.value = rt;
                        opt.textContent = rt;
                        roomSelect.appendChild(opt);
                    });
                }
                updatePrice();
            }

            function updatePrice() {
                const retreat = retreatSelect.value;
                const room = roomSelect.value;
                const priceInput = document.getElementById("price");
                
                if (pricing[retreat] && pricing[retreat][room]) {
                    const price = pricing[retreat][room];
                    priceInput.value = "$" + price;
                    priceDisplay.textContent = "$" + price;
                } else {
                    priceInput.value = "";
                    priceDisplay.textContent = "$0";
                }
            }

            function updateDepartureDate() {
                const retreat = retreatSelect.value;
                const nights = retreatDuration[retreat];
                if (arrivalInput.value && nights) {
                    const arrival = new Date(arrivalInput.value);
                    const departure = new Date(arrival);
                    departure.setDate(arrival.getDate() + nights);
                    departureInput.value = departure.toISOString().split('T')[0];
                }
            }

            async function handleBookingSubmit(e) {
                e.preventDefault();
                const form = e.target;
                const bookingCode = Math.floor(1000000 + Math.random() * 9000000);

                const data = {
                    guest_name: form.guest_name.value,
                    country: form.country.value,
                    email: form.email.value,
                    phone: phoneHiddenInput.value,
                    package: form.package.value,
                    room_type: form.room_type.value,
                    price: document.getElementById("price").value,
                    arrival_date: form.arrival_date.value,
                    departure_date: form.departure_date.value,
                    remarks: form.remarks.value,
                    booking_code: bookingCode,
                    timestamp: new Date().toISOString()
                };

                try {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    submitBtn.textContent = "Submitting...";
                    submitBtn.disabled = true;

                    const response = await fetch(scriptURL, {
                        method: "POST",
                        headers: { "Content-Type": "text/plain;charset=UTF-8" },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        downloadConfirmationAsImage(data);
                        showSuccessMessage();
                        form.reset();
                        roomSelect.innerHTML = "<option value='' disabled selected>Select Room Type</option>";
                        document.getElementById("price").value = "";
                        priceDisplay.textContent = "$0";
                    } else {
                        throw new Error('Submission failed');
                    }
                } catch (error) {
                    alert('Failed to submit booking. Please try again.');
                } finally {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    submitBtn.textContent = "Submit Booking";
                    submitBtn.disabled = false;
                }
            }

            function downloadConfirmationAsImage(data) {
                const confirmationDiv = createStyledConfirmation(data);
                confirmationDiv.style.position = 'fixed';
                confirmationDiv.style.left = '50%';
                confirmationDiv.style.top = '50%';
                confirmationDiv.style.transform = 'translate(-50%, -50%)';
                confirmationDiv.style.zIndex = 9999;
                document.body.appendChild(confirmationDiv);

                html2canvas(confirmationDiv, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: "#FFFFFF"
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'Sadhana Booking Confirmation.jpg';
                    link.href = canvas.toDataURL('image/jpeg', 0.92);
                    link.click();
                    document.body.removeChild(confirmationDiv);
                });
            }

            function createStyledConfirmation(data) {
                const div = document.createElement('div');
                div.style.cssText = `
                    width: 1200px; height: 900px; padding: 40px;
                    background: linear-gradient(135deg, #f9f7f2 0%, #ffffff 100%);
                    border: 4px solid #506C4A; border-radius: 20px;
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    color: #192812; display: flex; flex-direction: column;
                    justify-content: space-between; box-sizing: border-box;
                `;
                
                div.innerHTML = `
                    <div style="text-align:center;">
                        <h1 style="font-size: 42px; margin: 0 0 6px 0; color: #506C4A;">Sadhana Yoga Retreat</h1>
                        <h2 style="font-size: 22px; margin: 0 0 12px 0; color: #8DA399;">Booking Confirmation</h2>
                    </div>
                    <div style="display:flex; gap:18px;">
                        <div style="flex:1; padding:12px 16px; border-radius:10px; background:rgba(80,108,74,0.04); border-left:4px solid #506C4A;">
                            <div style="font-size:14px; color:#506C4A; font-weight:700;">Guest</div>
                            <div style="font-size:18px; margin-top:8px; font-weight:600;">${data.guest_name}</div>
                            <div style="font-size:14px; margin-top:6px;">${data.country}</div>
                        </div>
                        <div style="flex:1; padding:12px 16px; border-radius:10px; background:rgba(80,108,74,0.04); border-left:4px solid #506C4A;">
                            <div style="font-size:14px; color:#506C4A; font-weight:700;">Booking</div>
                            <div style="font-size:18px; margin-top:8px; font-weight:600;">${data.package}</div>
                            <div style="font-size:14px; margin-top:6px;">Room: ${data.room_type}</div>
                        </div>
                    </div>
                    <div style="display:flex; gap:18px;">
                        <div style="flex:1; padding:12px 16px; border-radius:10px; background:rgba(201,169,110,0.08); border:2px solid #C9A96E; text-align:center;">
                            <div style="font-size:14px; color:#666;">Arrival</div>
                            <div style="font-size:20px; font-weight:700; color:#506C4A; margin-top:6px;">${formatDate(data.arrival_date)} at 3 PM</div>
                        </div>
                        <div style="flex:1; padding:12px 16px; border-radius:10px; background:rgba(201,169,110,0.08); border:2px solid #C9A96E; text-align:center;">
                            <div style="font-size:14px; color:#666;">Departure</div>
                            <div style="font-size:20px; font-weight:700; color:#506C4A; margin-top:6px;">${formatDate(data.departure_date)} at 11 AM</div>
                        </div>
                    </div>
                    <div style="text-align:center;">
                        <div style="font-size:14px; color:#666;">Total Amount</div>
                        <div style="font-size:36px; font-weight:800; color:#506C4A; margin-top:6px;">${data.price}</div>
                        <div style="font-size:16px; margin-top:20px; color:#c04a4a; font-weight:700;">Booking Code: ${data.booking_code}</div>
                    </div>
                `;
                return div;
            }

            function formatDate(dateStr) {
                const d = new Date(dateStr);
                const day = d.getDate();
                const daySuffix = day % 10 === 1 && day !== 11 ? "st" : day % 10 === 2 && day !== 12 ? "nd" : day % 10 === 3 && day !== 13 ? "rd" : "th";
                return `${day}${daySuffix} ${d.toLocaleString('en-US', { month: 'long' })} ${d.getFullYear()}`;
            }

            function showSuccessMessage() {
                const successDiv = document.createElement('div');
                successDiv.style.cssText = `
                    padding: 15px; margin: 15px 0; border-radius: 12px;
                    background: rgba(80, 108, 74, 0.1); color: #506C4A;
                    border: 1px solid #506C4A; text-align: center;
                `;
                successDiv.innerHTML = `<h3>âœ“ Booking Successfully Submitted!</h3><p>Your confirmation has been downloaded.</p>`;
                document.getElementById("bookingForm").parentNode.insertBefore(successDiv, document.getElementById("bookingForm").nextSibling);
                setTimeout(() => successDiv.remove(), 5000);
            }
        });
    </script>
</body>
</html>